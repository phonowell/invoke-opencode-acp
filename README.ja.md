[English](README.md) | [中文](README.zh.md) | [日本語](README.ja.md)

# invoke-opencode-acp

## 用語集 (Glossary)

| 日本語 (カタカナ) | 日本語 (漢字) | English | 中文 |
|------------------|--------------|---------|------|
| スキル | 技能 | skill | 技能 |
| サブエージェント | 子代理 | subagent | 子代理 |
| 委任 | 委任 | delegate | 委托 |
| トークン | 令牌 | token | 令牌 |
| プロトコル | 协議 | protocol | 协议 |
| プログラム | 程序 | program | 程序 |
| 関数 | 関数 | function | 函数 |
| メソッド | 方法 | method | 方法 |
| パラメータ | 引数 | parameter | 参数 |
| 変数 | 変数 | variable | 变量 |
| 定数 | 定数 | constant | 常量 |
| クラス | クラス | class | 类 |
| インスタンス | インスタンス | instance | 实例 |
| モジュール | モジュール | module | 模块 |
| パッケージ | パッケージ | package | 包 |
| ライブラリ | ライブラリ | library | 库 |
| フレームワーク | フレームワーク | framework | 框架 |
| プロセス | プロセス | process | 进程 |
| スレッド | スレッド | thread | 线程 |
| 非同期 | 非同期 | asynchronous | 异步 |
| 同期 | 同期 | synchronous | 同步 |
| ストリーム | ストリーム | stream | 流 |
| バッファ | バッファ | buffer | 缓冲区 |
| イベント | イベント | event | 事件 |
| リスナー | リスナー | listener | 监听器 |
| コールバック | コールバック | callback | 回调 |
| プロミス | プロミス | promise | 承诺 |
| エラー | エラー | error | 错误 |
| 例外 | 例外 | exception | 异常 |
| タイムアウト | タイムアウト | timeout | 超时 |
| セッション | セッション | session | 会话 |
| リクエスト | リクエスト | request | 请求 |
| レスポンス | レスポンス | response | 响应 |
| ファイル | ファイル | file | 文件 |
| ディレクトリ | ディレクトリ | directory | 目录 |
| パス | パス | path | 路径 |
| コード | コード | code | 代码 |
| テスト | テスト | test | 测试 |
| ドキュメント | ドキュメント | document | 文档 |
| コンコンテキスト | コンコンテキスト | context | 上下文 |
| 実装 | 実装 | implementation | 实现 |
| 依存関係 | 依存関係 | dependency | 依存 |
| ライセンス | ライセンス | license | 许可证 |

---

**[Claude Code CLI](https://claude.ai/code) のためのスキル**で、複雑なタスクをOpenCodeサブエージェントに委任し、数千のトークンを節約します。

> **注意**: これはClaude Code CLIツールのスキルであり、独立したアプリケーションではありません。使用するにはClaude Codeがインストールされている必要があります。
>
> **要件**: このスキルは**OpenCode**（ACPプロトコル経由）と**Node.js**を必要とします。

## このスキルの機能

**OpenCodeサブエージェントに複雑なタスクを委任**し、ACPプロトコル経由でメインのClaude会話が過剰なトークンを消費するのを防ぎます。

専門の請負人を雇うようなものと考えてください：あなたが目標を提供し、彼らが独立して作業し、会話履歴を埋める往復なしで結果を得ます。

## メリット

### 大規模なトークン節約

- **このスキルを使用しない場合**: メインClaudeが各ファイルを読み込み→分析→編集→繰り返し。各イテレーションで数千のトークンを消費。
- **このスキルを使用する場合**: 目標をサブエージェントに送信→サブエージェントが独立して作業→最終結果を取得。サマリーのみが会話に記録されます。

**典型的な節約**: 複雑なタスクで50-90%のトークン削減。

### 重要なトレードオフ

**節約の仕組み**: OpenCodeサブエージェントは無料トークンを使用してGLM-4.7、Qwenなどの代替モデルを呼び出し、有料のClaudeトークンを消費しません。

**这意味着**:
- ✅ **トークン節約**: サブエージェントの作業は完全に無料
- ⚠️ **能力のトレードオフ**: 代替モデルはClaudeに比べて推論能力が低い
- ⚠️ **品質のばらつき**: 結果が繊細でない可能性があり、レビューが必要

**最適な使用例**:
- コードリファクタリングとフォーマット（単純明快）
- ドキュメント更新と生成
- テストコード生成
- 要件が明確なバグ修正
- バッチファイル操作

**代替案を検討すべきケース**:
- 複雑なアーキテクチャ決定
- 繊細なコードレビュー
- 感度の高いロジック変更
- 深いドメイン専門知識を必要とするタスク

### より高速なタスク完了

- メインClaudeは他のタスクに対応可能
- サブエージェントが並行して作業
- サブタスクにコンコンテキストウィンドウの制限なし

### 複雑なワークフローに最適

以下に最適です:
- **多ファイルリファクタリング**: 「すべてのPythonファイルに型ヒントを追加」
- **バッチ操作**: 「すべてのドキュメントファイルを更新」
- **コードレビュー**: 「コードベース全体のセキュリティ問題を確認」
- **Gitワークフロー**: 「これらの変更でプルリクエストを作成」

## 動作原理

1. **タスクを説明**（1文で十分）
2. **OpenCodeサブエージェントが目標を受信**し独立して作業
3. **結果がファイルに保存**（会話ではなく）
4. **メイン会話で簡潔なサマリーを取得**

サブエージェントはファイルの読み込み、編集、テスト実行など、完全な開発者として動作し、メイン会話のコンコンテキストを消費しません。

## インストール

### 前提条件

3つのものをインストールする必要があります:

1. **Claude Code CLI**（使用中ならすでにインストール済み）
2. **OpenCode CLI**（`npm install -g opencode`）
3. **Node.js**（ほとんどのシステムに搭載）

### クイックインストール

```bash
# 1. OpenCodeをインストール（まだの場合）
npm install -g opencode

# 2. スキルをClaudeにコピー
cp -r skills/invoke-opencode-acp ~/.claude/skills/

# 3. 動作確認（オプション）
node ~/.claude/skills/invoke-opencode-acp/tests/test_acp_client.js
```

### インストール確認

OpenCodeがインストールされているか確認:
```bash
opencode --version
```

スキルが存在するか確認:
```bash
ls ~/.claude/skills/invoke-opencode-acp/SKILL.md
```

## 使用方法

Claudeに何をしたいか伝えるだけ:

> 「このプロジェクトのすべてのPythonファイルに型ヒントを追加」

ClaudeはタスクをOpenCodeサブエージェントに委任し、結果を返します。

**タイムアウトガイドライン**（OpenCodeは遅い）:
- 簡単なタスク（数学、短い回答）: 最低180秒（3分）
- 中程度のタスク（単一ファイル、約100行）: 最低600秒（10分）
- 複雑なタスク（多ファイル、リファクタリング）: 最低1800秒（30分）

**タスク例**:
- 「コードベース全体をリファクタリング」
- 「新しいインストール説明でREADME.mdを更新」
- 「すべてのPythonファイルに型ヒントを追加」
- 「コードベースにセキュリティ監査を実行」

## 実例

### 例1: 大規模リファクタリング

**あなたのリクエスト**: 「このプロジェクトのすべてのPythonファイルに型ヒントを追加」

**このスキルを使用しない場合**:
- Claudeが各ファイルを読み込み（10,000トークン）
- Claudeが各ファイルを編集（15,000トークン）
- Claudeが変更を検証（8,000トークン）
- **合計**: 約33,000トークン消費

**このスキルを使用する場合**:
- 目標を送信（50トークン）
- サブエージェントが独立して作業（会話内で0トークン）
- サマリーを取得（200トークン）
- **合計**: 約250トークン消費

**節約**: 99%トークン削減！

### 例2: コードレビュー

**あなたのリクエスト**: 「コードベース全体のセキュリティ脆弱性を確認」

**このスキルを使用しない場合**:
- Claudeがすべてのソースファイルを読み込み（25,000トークン）
- Claudeが分析と記録（12,000トークン）
- **合計**: 約37,000トークン

**このスキルを使用する場合**:
- 目標 + サマリー（~300トークン）
- **合計**: 約300トークン

**節約**: 99%トークン削減！

### 例3: バッチドキュメント更新

**あなたのリクエスト**: 「すべての.mdファイルに新しいライセンスヘッダーを追加」

**このスキルを使用しない場合**:
- Claudeが20個のmarkdownファイルを読み込み（15,000トークン）
- Claudeが各ファイルを編集（20,000トークン）
- **合計**: 約35,000トークン

**このスキルを使用する場合**:
- 目標 + サマリー（~250トークン）
- **合計**: 約250トークン

**節約**: 99%トークン削減！

## いつ使用するか

**✅ このスキルを使用する**:
- 2個以上のファイルに影響するタスク
- リファクタリングや構造変更
- バッチ操作（多くのファイルで検索置換）
- コードベース全体のコードレビュー
- 研究と分析を必要とする多ステップタスク
- Gitワークフロー（コミット、プッシュ、プルリクエスト）

**❌ 使用しない**:
- 単一ファイルのクイック編集
- 単純なテキスト置換
- メイン会話と統合が必要なタスク

## 他の方法との違い

### vs. 通常のClaudeタスク

| 面 | 通常のClaude | invoke-opencode-acpを使用 |
|------|--------------|-------------------------|
| コンテキスト使用 | 完全なファイル内容 | 目標のみ |
| トークン消費 | 高い（数千） | 低い（数百） |
| あなたの会話 | すべてのステップを表示 | 結果のみ表示 |
| 速度 | シリアル | 並行 |
| 最適 | 単純タスク | 複雑タスク |

### vs. 他のソリューション

- **Claude Projects**: メインコンテキストウィンドウを使用（トークン制限あり）
- **手動委任**: コピー＆ペーストが必要、自動化なし
- **invoke-opencode-acp**: 自動化された委任、最小限のコンテキスト使用

## トラブルシューティング

**「opencode command not found」**
```bash
npm install -g opencode
```

**「Skill not enabled」**
- スキルが`~/.claude/skills/invoke-opencode-acp/`にあるか確認
- Claude Codeを再起動
- Claude Code設定で有効化

**タスクタイムアウト**
- `-t`パラメータ値を増やす
- 使用方法のタイムアウトガイドラインを参照
- OpenCodeは遅く、特に複雑なタスクでは顕著

## 技術詳細（好奇心向け）

このスキルはACP（Agent Control Protocol）を使用してOpenCodeと通信します:

1. `opencode acp`をNode.js child_processで起動
2. JSON-RPC経由で専用セッションを作成
3. `session/prompt`経由でタスクを送信
4. `session/update`イベント経由でストリーム結果
5. `<thinking>`タグをフィルタリング
6. 最終出力のみを返却

**実装**: `skills/invoke-opencode-acp/acp_client.js`（192行）

## ライセンス

MIT License - 詳細は[LICENSE](LICENSE)を参照。

---

English version: [README.md](README.md)
中文版本: [README.zh.md](README.zh.md)
